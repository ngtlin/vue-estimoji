import { __extends, __values } from "tslib";
import { searchAndInitialize } from "../Utils";
import DomElement from "../DomElement";
import { parentWithClass, getRootElement } from "../DomFunctions";
var CLASS_BORDER = "empty-state__border";
var CLASS_BORDER_MODAL = "empty-state__border--modal";
var CLASS_ACTIVE = "is-active";
var CLASS_HASFILES = "has-files";
var CLASS_MODAL = "empty-state--modal";
var CLASS_MODAL_CONTENT = "modal__content";
var QUERY_MODAL_BODY = ".modal__body";
var QUERY_FILE = "input[type='file']";
/**
 * Empty state pattern
 */
var EmptyState = /** @class */ (function (_super) {
    __extends(EmptyState, _super);
    /**
     * Creates and initializes the Empty-State pattern component.
     * @param {DomElement} - root element of the empty-state pattern.
     */
    function EmptyState(element) {
        var _this = _super.call(this, element) || this;
        _this._fileInput = _this.element.querySelector(QUERY_FILE);
        _this._button = _this.element.querySelector("label");
        _this._fileChangedHandler = _this._handleFileChanged.bind(_this);
        _this._preventEventsHandler = _this._preventDragEvents.bind(_this);
        _this._dragEnterHandler = _this._handleDragEnter.bind(_this);
        _this._dragLeaveHandler = _this._handleDragLeave.bind(_this);
        _this._dropHandler = _this._handleDrop.bind(_this);
        _this._isDragging = false;
        _this._initialize();
        return _this;
    }
    EmptyState.prototype._initialize = function () {
        var e_1, _a;
        if (this.hasClass(CLASS_MODAL)) {
            // handle modal dialogs
            this._dragArea = parentWithClass(this.element, CLASS_MODAL_CONTENT);
            var borderArea = this._dragArea.querySelector(QUERY_MODAL_BODY);
            borderArea.setAttribute("style", "pointer-events: none;");
            this._border = new DomElement("div")
                .addClass(CLASS_BORDER)
                .addClass(CLASS_BORDER_MODAL);
            borderArea.appendChild(this._border.element);
        }
        else {
            // normal modal dialog
            this._dragArea = this.element;
            var borderArea = getRootElement();
            this._border = new DomElement("div")
                .addClass(CLASS_BORDER);
            if (!borderArea.querySelector("." + CLASS_BORDER)) {
                borderArea.appendChild(this._border.element);
            }
        }
        var form = this.element.querySelector("form");
        try {
            for (var _b = __values(["drag", "dragstart", "dragend", "dragover", "dragenter", "dragleave", "drop"]), _c = _b.next(); !_c.done; _c = _b.next()) {
                var event_1 = _c.value;
                this.element.addEventListener(event_1, this._preventEventsHandler);
                form.addEventListener(event_1, this._preventEventsHandler);
                this._dragArea.addEventListener(event_1, this._preventEventsHandler);
            }
        }
        catch (e_1_1) { e_1 = { error: e_1_1 }; }
        finally {
            try {
                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
            }
            finally { if (e_1) throw e_1.error; }
        }
        this._dragArea.addEventListener("dragover", this._dragEnterHandler);
        this._dragArea.addEventListener("dragenter", this._dragEnterHandler);
        this._dragArea.addEventListener("dragleave", this._dragLeaveHandler);
        this._dragArea.addEventListener("dragend", this._dragLeaveHandler);
        this._dragArea.addEventListener("drop", this._dragLeaveHandler);
        this._dragArea.addEventListener("drop", this._dropHandler);
        this._fileInput.addEventListener("change", this._fileChangedHandler);
    };
    EmptyState.prototype._preventDragEvents = function (e) {
        e.preventDefault();
        e.stopPropagation();
        return false;
    };
    EmptyState.prototype._handleDragEnter = function () {
        if (this._isDragging === true) {
            return;
        }
        this._isDragging = true;
        this._button.setAttribute("style", "pointer-events: none;");
        this.addClass(CLASS_ACTIVE);
        this._border.addClass(CLASS_ACTIVE);
    };
    EmptyState.prototype._handleDragLeave = function () {
        if (this._isDragging === false) {
            return;
        }
        this._isDragging = false;
        this._button.setAttribute("style", "");
        this.removeClass(CLASS_ACTIVE);
        this._border.removeClass(CLASS_ACTIVE);
    };
    EmptyState.prototype._handleDrop = function (e) {
        var dragEvent = e;
        this._fileInput.files = dragEvent.dataTransfer.files;
    };
    EmptyState.prototype._handleFileChanged = function () {
        var files = this._fileInput.files;
        if (files && files.length > 0) {
            this.addClass(CLASS_HASFILES);
        }
        else {
            this.removeClass(CLASS_HASFILES);
        }
    };
    Object.defineProperty(EmptyState.prototype, "files", {
        /**
         * Gets the currently selected files.
         */
        get: function () {
            return this._fileInput.files;
        },
        enumerable: false,
        configurable: true
    });
    return EmptyState;
}(DomElement));
export function init() {
    searchAndInitialize(".empty-state", function (e) {
        new EmptyState(e);
    });
}
export default EmptyState;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4vc3JjL2VtcHR5LXN0YXRlcy9FbXB0eVN0YXRlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSxVQUFVLENBQUE7QUFDOUMsT0FBTyxVQUFVLE1BQU0sZUFBZSxDQUFBO0FBQ3RDLE9BQU8sRUFBRSxlQUFlLEVBQUUsY0FBYyxFQUFFLE1BQU0saUJBQWlCLENBQUE7QUFFakUsSUFBTSxZQUFZLEdBQUcscUJBQXFCLENBQUE7QUFDMUMsSUFBTSxrQkFBa0IsR0FBRyw0QkFBNEIsQ0FBQTtBQUN2RCxJQUFNLFlBQVksR0FBRyxXQUFXLENBQUE7QUFDaEMsSUFBTSxjQUFjLEdBQUcsV0FBVyxDQUFBO0FBQ2xDLElBQU0sV0FBVyxHQUFHLG9CQUFvQixDQUFBO0FBQ3hDLElBQU0sbUJBQW1CLEdBQUcsZ0JBQWdCLENBQUE7QUFFNUMsSUFBTSxnQkFBZ0IsR0FBRyxjQUFjLENBQUE7QUFDdkMsSUFBTSxVQUFVLEdBQUcsb0JBQW9CLENBQUE7QUFFdkM7O0dBRUc7QUFDSDtJQUF5Qiw4QkFBVTtJQWdCakM7OztPQUdHO0lBQ0gsb0JBQVksT0FBZ0I7UUFBNUIsWUFDRSxrQkFBTSxPQUFPLENBQUMsU0FjZjtRQVpDLEtBQUksQ0FBQyxVQUFVLEdBQUcsS0FBSSxDQUFDLE9BQU8sQ0FBQyxhQUFhLENBQUMsVUFBVSxDQUFzQixDQUFBO1FBQzdFLEtBQUksQ0FBQyxPQUFPLEdBQUcsS0FBSSxDQUFDLE9BQU8sQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUFFLENBQUE7UUFFbkQsS0FBSSxDQUFDLG1CQUFtQixHQUFHLEtBQUksQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsS0FBSSxDQUFDLENBQUE7UUFDN0QsS0FBSSxDQUFDLHFCQUFxQixHQUFHLEtBQUksQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsS0FBSSxDQUFDLENBQUE7UUFDL0QsS0FBSSxDQUFDLGlCQUFpQixHQUFHLEtBQUksQ0FBQyxn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QU0sU0FBUyxHQUFHLENBQWMsQ0FBQTtRQUMvQixJQUFJLENBQUMsVUFBa0IsQ0FBQyxLQUFLLEdBQUcsU0FBUyxDQUFDLFlBQWEsQ0FBQyxLQUFLLENBQUE7SUFDaEUsQ0FBQztJQUVTLHVDQUFrQixHQUE1QjtRQUNFLElBQUksS0FBSyxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFBO1FBRWpDLElBQUksS0FBSyxJQUFJLEtBQUssQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO1lBQzdCLElBQUksQ0FBQyxRQUFRLENBQUMsY0FBYyxDQUFDLENBQUE7U0FDOUI7YUFBTTtZQUNMLElBQUksQ0FBQyxXQUFXLENBQUMsY0FBYyxDQUFDLENBQUE7U0FDakM7SUFDSCxDQUFDO0lBS0Qsc0JBQUksNkJBQUs7UUFIVDs7V0FFRzthQUNIO1lBQ0UsT0FBTyxJQUFJLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQTtRQUM5QixDQUFDOzs7T0FBQTtJQUNILGlCQUFDO0FBQUQsQ0F0SUEsQUFzSUMsQ0F0SXdCLFVBQVUsR0FzSWxDO0FBRUQsTUFBTSxVQUFVLElBQUk7SUFDbEIsbUJBQW1CLENBQUMsY0FBYyxFQUFFLFVBQUMsQ0FBQztRQUNwQyxJQUFJLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQTtJQUNuQixDQUFDLENBQUMsQ0FBQTtBQUNKLENBQUM7QUFFRCxlQUFlLFVBQVUsQ0FBQSIsImZpbGUiOiJtYWluL3NyYy9lbXB0eS1zdGF0ZXMvRW1wdHlTdGF0ZS5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHNlYXJjaEFuZEluaXRpYWxpemUgfSBmcm9tIFwiLi4vVXRpbHNcIlxuaW1wb3J0IERvbUVsZW1lbnQgZnJvbSBcIi4uL0RvbUVsZW1lbnRcIlxuaW1wb3J0IHsgcGFyZW50V2l0aENsYXNzLCBnZXRSb290RWxlbWVudCB9IGZyb20gXCIuLi9Eb21GdW5jdGlvbnNcIlxuXG5jb25zdCBDTEFTU19CT1JERVIgPSBcImVtcHR5LXN0YXRlX19ib3JkZXJcIlxuY29uc3QgQ0xBU1NfQk9SREVSX01PREFMID0gXCJlbXB0eS1zdGF0ZV9fYm9yZGVyLS1tb2RhbFwiXG5jb25zdCBDTEFTU19BQ1RJVkUgPSBcImlzLWFjdGl2ZVwiXG5jb25zdCBDTEFTU19IQVNGSUxFUyA9IFwiaGFzLWZpbGVzXCJcbmNvbnN0IENMQVNTX01PREFMID0gXCJlbXB0eS1zdGF0ZS0tbW9kYWxcIlxuY29uc3QgQ0xBU1NfTU9EQUxfQ09OVEVOVCA9IFwibW9kYWxfX2NvbnRlbnRcIlxuXG5jb25zdCBRVUVSWV9NT0RBTF9CT0RZID0gXCIubW9kYWxfX2JvZHlcIlxuY29uc3QgUVVFUllfRklMRSA9IFwiaW5wdXRbdHlwZT0nZmlsZSddXCJcblxuLyoqXG4gKiBFbXB0eSBzdGF0ZSBwYXR0ZXJuXG4gKi9cbmNsYXNzIEVtcHR5U3RhdGUgZXh0ZW5kcyBEb21FbGVtZW50IHtcbiAgcHJpdmF0ZSBfYm9yZGVyITogRG9tRWxlbWVudDxIVE1MRGl2RWxlbWVudD5cblxuICBwcml2YXRlIF9maWxlSW5wdXQ6IEhUTUxJbnB1dEVsZW1lbnRcbiAgcHJpdmF0ZSBfYnV0dG9uOiBIVE1MTGFiZWxFbGVtZW50XG5cbiAgcHJpdmF0ZSBfZHJhZ0FyZWEhOiBFbGVtZW50XG5cbiAgcHJpdmF0ZSBfZmlsZUNoYW5nZWRIYW5kbGVyOiAoZXZlbnQ6IEV2ZW50KSA9PiB2b2lkXG4gIHByaXZhdGUgX3ByZXZlbnRFdmVudHNIYW5kbGVyOiAoZXZlbnQ6IEV2ZW50KSA9PiB2b2lkXG4gIHByaXZhdGUgX2RyYWdFbnRlckhhbmRsZXI6IChldmVudDogRXZlbnQpID0+IHZvaWRcbiAgcHJpdmF0ZSBfZHJhZ0xlYXZlSGFuZGxlcjogKGV2ZW50OiBFdmVudCkgPT4gdm9pZFxuICBwcml2YXRlIF9kcm9wSGFuZGxlcjogKGV2ZW50OiBFdmVudCkgPT4gdm9pZFxuXG4gIHByaXZhdGUgX2lzRHJhZ2dpbmc6IGJvb2xlYW5cblxuICAvKipcbiAgICogQ3JlYXRlcyBhbmQgaW5pdGlhbGl6ZXMgdGhlIEVtcHR5LVN0YXRlIHBhdHRlcm4gY29tcG9uZW50LlxuICAgKiBAcGFyYW0ge0RvbUVsZW1lbnR9IC0gcm9vdCBlbGVtZW50IG9mIHRoZSBlbXB0eS1zdGF0ZSBwYXR0ZXJuLlxuICAgKi9cbiAgY29uc3RydWN0b3IoZWxlbWVudDogRWxlbWVudCkge1xuICAgIHN1cGVyKGVsZW1lbnQpXG5cbiAgICB0aGlzLl9maWxlSW5wdXQgPSB0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3RvcihRVUVSWV9GSUxFKSEgYXMgSFRNTElucHV0RWxlbWVudFxuICAgIHRoaXMuX2J1dHRvbiA9IHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwibGFiZWxcIikhXG5cbiAgICB0aGlzLl9maWxlQ2hhbmdlZEhhbmRsZXIgPSB0aGlzLl9oYW5kbGVGaWxlQ2hhbmdlZC5iaW5kKHRoaXMpXG4gICAgdGhpcy5fcHJldmVudEV2ZW50c0hhbmRsZXIgPSB0aGlzLl9wcmV2ZW50RHJhZ0V2ZW50cy5iaW5kKHRoaXMpXG4gICAgdGhpcy5fZHJhZ0VudGVySGFuZGxlciA9IHRoaXMuX2hhbmRsZURyYWdFbnRlci5iaW5kKHRoaXMpXG4gICAgdGhpcy5fZHJhZ0xlYXZlSGFuZGxlciA9IHRoaXMuX2hhbmRsZURyYWdMZWF2ZS5iaW5kKHRoaXMpXG4gICAgdGhpcy5fZHJvcEhhbmRsZXIgPSB0aGlzLl9oYW5kbGVEcm9wLmJpbmQodGhpcylcblxuICAgIHRoaXMuX2lzRHJhZ2dpbmcgPSBmYWxzZVxuXG4gICAgdGhpcy5faW5pdGlhbGl6ZSgpXG4gIH1cblxuICBwcm90ZWN0ZWQgX2luaXRpYWxpemUoKSB7XG4gICAgaWYgKHRoaXMuaGFzQ2xhc3MoQ0xBU1NfTU9EQUwpKSB7XG4gICAgICAvLyBoYW5kbGUgbW9kYWwgZGlhbG9nc1xuICAgICAgdGhpcy5fZHJhZ0FyZWEgPSBwYXJlbnRXaXRoQ2xhc3ModGhpcy5lbGVtZW50LCBDTEFTU19NT0RBTF9DT05URU5UKSFcbiAgICAgIGxldCBib3JkZXJBcmVhID0gdGhpcy5fZHJhZ0FyZWEucXVlcnlTZWxlY3RvcihRVUVSWV9NT0RBTF9CT0RZKSFcbiAgICAgIGJvcmRlckFyZWEuc2V0QXR0cmlidXRlKFwic3R5bGVcIiwgXCJwb2ludGVyLWV2ZW50czogbm9uZTtcIilcblxuICAgICAgdGhpcy5fYm9yZGVyID0gbmV3IERvbUVsZW1lbnQ8SFRNTERpdkVsZW1lbnQ+KFwiZGl2XCIpXG4gICAgICAgIC5hZGRDbGFzcyhDTEFTU19CT1JERVIpXG4gICAgICAgIC5hZGRDbGFzcyhDTEFTU19CT1JERVJfTU9EQUwpXG5cbiAgICAgIGJvcmRlckFyZWEuYXBwZW5kQ2hpbGQodGhpcy5fYm9yZGVyLmVsZW1lbnQpXG5cbiAgICB9IGVsc2Uge1xuICAgICAgLy8gbm9ybWFsIG1vZGFsIGRpYWxvZ1xuICAgICAgdGhpcy5fZHJhZ0FyZWEgPSB0aGlzLmVsZW1lbnRcbiAgICAgIGxldCBib3JkZXJBcmVhID0gZ2V0Um9vdEVsZW1lbnQoKVxuXG4gICAgICB0aGlzLl9ib3JkZXIgPSBuZXcgRG9tRWxlbWVudDxIVE1MRGl2RWxlbWVudD4oXCJkaXZcIilcbiAgICAgICAgLmFkZENsYXNzKENMQVNTX0JPUkRFUilcblxuICAgICAgaWYgKCFib3JkZXJBcmVhLnF1ZXJ5U2VsZWN0b3IoYC4ke0NMQVNTX0JPUkRFUn1gKSkge1xuICAgICAgICBib3JkZXJBcmVhLmFwcGVuZENoaWxkKHRoaXMuX2JvcmRlci5lbGVtZW50KVxuICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0IGZvcm0gPSB0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3RvcihcImZvcm1cIikhXG5cbiAgICBmb3IgKGxldCBldmVudCBvZiBbIFwiZHJhZ1wiLCBcImRyYWdzdGFydFwiLCBcImRyYWdlbmRcIiwgXCJkcmFnb3ZlclwiLCBcImRyYWdlbnRlclwiLCBcImRyYWdsZWF2ZVwiLCBcImRyb3BcIiBdKSB7XG4gICAgICB0aGlzLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihldmVudCwgdGhpcy5fcHJldmVudEV2ZW50c0hhbmRsZXIpXG4gICAgICBmb3JtLmFkZEV2ZW50TGlzdGVuZXIoZXZlbnQsIHRoaXMuX3ByZXZlbnRFdmVudHNIYW5kbGVyKVxuICAgICAgdGhpcy5fZHJhZ0FyZWEuYWRkRXZlbnRMaXN0ZW5lcihldmVudCwgdGhpcy5fcHJldmVudEV2ZW50c0hhbmRsZXIpXG4gICAgfVxuXG4gICAgdGhpcy5fZHJhZ0FyZWEuYWRkRXZlbnRMaXN0ZW5lcihcImRyYWdvdmVyXCIsIHRoaXMuX2RyYWdFbnRlckhhbmRsZXIpXG4gICAgdGhpcy5fZHJhZ0FyZWEuYWRkRXZlbnRMaXN0ZW5lcihcImRyYWdlbnRlclwiLCB0aGlzLl9kcmFnRW50ZXJIYW5kbGVyKVxuXG4gICAgdGhpcy5fZHJhZ0FyZWEuYWRkRXZlbnRMaXN0ZW5lcihcImRyYWdsZWF2ZVwiLCB0aGlzLl9kcmFnTGVhdmVIYW5kbGVyKVxuICAgIHRoaXMuX2RyYWdBcmVhLmFkZEV2ZW50TGlzdGVuZXIoXCJkcmFnZW5kXCIsIHRoaXMuX2RyYWdMZWF2ZUhhbmRsZXIpXG4gICAgdGhpcy5fZHJhZ0FyZWEuYWRkRXZlbnRMaXN0ZW5lcihcImRyb3BcIiwgdGhpcy5fZHJhZ0xlYXZlSGFuZGxlcilcblxuICAgIHRoaXMuX2RyYWdBcmVhLmFkZEV2ZW50TGlzdGVuZXIoXCJkcm9wXCIsIHRoaXMuX2Ryb3BIYW5kbGVyKVxuICAgIHRoaXMuX2ZpbGVJbnB1dC5hZGRFdmVudExpc3RlbmVyKFwiY2hhbmdlXCIsIHRoaXMuX2ZpbGVDaGFuZ2VkSGFuZGxlcilcbiAgfVxuXG4gIHByb3RlY3RlZCBfcHJldmVudERyYWdFdmVudHMoZTogRXZlbnQpIHtcbiAgICBlLnByZXZlbnREZWZhdWx0KClcbiAgICBlLnN0b3BQcm9wYWdhdGlvbigpXG5cbiAgICByZXR1cm4gZmFsc2VcbiAgfVxuXG4gIHByb3RlY3RlZCBfaGFuZGxlRHJhZ0VudGVyKCkge1xuICAgIGlmICh0aGlzLl9pc0RyYWdnaW5nID09PSB0cnVlKSB7XG4gICAgICByZXR1cm5cbiAgICB9XG5cbiAgICB0aGlzLl9pc0RyYWdnaW5nID0gdHJ1ZVxuICAgIHRoaXMuX2J1dHRvbi5zZXRBdHRyaWJ1dGUoXCJzdHlsZVwiLCBcInBvaW50ZXItZXZlbnRzOiBub25lO1wiKVxuXG4gICAgdGhpcy5hZGRDbGFzcyhDTEFTU19BQ1RJVkUpXG4gICAgdGhpcy5fYm9yZGVyLmFkZENsYXNzKENMQVNTX0FDVElWRSlcbiAgfVxuXG4gIHByb3RlY3RlZCBfaGFuZGxlRHJhZ0xlYXZlKCkge1xuICAgIGlmICh0aGlzLl9pc0RyYWdnaW5nID09PSBmYWxzZSkge1xuICAgICAgcmV0dXJuXG4gICAgfVxuXG4gICAgdGhpcy5faXNEcmFnZ2luZyA9IGZhbHNlXG4gICAgdGhpcy5fYnV0dG9uLnNldEF0dHJpYnV0ZShcInN0eWxlXCIsIFwiXCIpXG5cbiAgICB0aGlzLnJlbW92ZUNsYXNzKENMQVNTX0FDVElWRSlcbiAgICB0aGlzLl9ib3JkZXIucmVtb3ZlQ2xhc3MoQ0xBU1NfQUNUSVZFKVxuICB9XG5cbiAgcHJvdGVjdGVkIF9oYW5kbGVEcm9wKGU6IEV2ZW50KSB7XG4gICAgY29uc3QgZHJhZ0V2ZW50ID0gZSBhcyBEcmFnRXZlbnRcbiAgICAodGhpcy5fZmlsZUlucHV0IGFzIGFueSkuZmlsZXMgPSBkcmFnRXZlbnQuZGF0YVRyYW5zZmVyIS5maWxlc1xuICB9XG5cbiAgcHJvdGVjdGVkIF9oYW5kbGVGaWxlQ2hhbmdlZCgpIHtcbiAgICBsZXQgZmlsZXMgPSB0aGlzLl9maWxlSW5wdXQuZmlsZXNcblxuICAgIGlmIChmaWxlcyAmJiBmaWxlcy5sZW5ndGggPiAwKSB7XG4gICAgICB0aGlzLmFkZENsYXNzKENMQVNTX0hBU0ZJTEVTKVxuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnJlbW92ZUNsYXNzKENMQVNTX0hBU0ZJTEVTKVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIHRoZSBjdXJyZW50bHkgc2VsZWN0ZWQgZmlsZXMuXG4gICAqL1xuICBnZXQgZmlsZXMoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2ZpbGVJbnB1dC5maWxlc1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpbml0KCkge1xuICBzZWFyY2hBbmRJbml0aWFsaXplKFwiLmVtcHR5LXN0YXRlXCIsIChlKSA9PiB7XG4gICAgbmV3IEVtcHR5U3RhdGUoZSlcbiAgfSlcbn1cblxuZXhwb3J0IGRlZmF1bHQgRW1wdHlTdGF0ZVxuIl0sInNvdXJjZVJvb3QiOiIuLi8uLi8uLi8uLi8uLiJ9
