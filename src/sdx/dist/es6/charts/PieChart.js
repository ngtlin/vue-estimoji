import { __extends } from "tslib";
import DomElement from "../DomElement";
import { searchAndInitialize } from "../Utils";
import { removeAllChildren, tryGetData, isColor } from "./ChartFunctions";
import anime from "animejs";
var QUERY_CHART = ".js-chart";
var QUERY_LEGEND = ".js-legend";
var DASH_SEPARATOR_WIDTH = 3;
var ANIMATION_DURATION = 1500;
var ANIMATION_DURATION_LEGEND = 500;
var QUERY_META_TITLE = ".meta .title";
var QUERY_META_SUBTITLE = ".meta .subtitle";
/**
 * Pie Chart Component.
 */
var PieChart = /** @class */ (function (_super) {
    __extends(PieChart, _super);
    /**
     * Creates and initializes the Pie Chart component.
     * @param {DomElement} - root element of the chart.
     * @param {Array} - pie chart data definitions.
     */
    function PieChart(element, data) {
        var _this = _super.call(this, element) || this;
        if (data) {
            _this._data = data;
        }
        _this._initialize();
        return _this;
    }
    PieChart.prototype._initialize = function () {
        this._chart = this.element.querySelector(QUERY_CHART);
        this._legend = this.element.querySelector(QUERY_LEGEND);
        this._title = this.element.querySelector(QUERY_META_TITLE);
        this._subtitle = this.element.querySelector(QUERY_META_SUBTITLE);
        this._unit = this.getAttribute("data-unit") || "";
        this._alwaysShowLegend = this.element.hasAttribute("data-always-show-legend");
        if (!this._data) {
            this._data = tryGetData(this.element);
        }
        this._render();
    };
    PieChart.prototype._render = function () {
        var total = this._data.reduce(function (a, b) { return a + b.value; }, 0);
        var r = 16;
        var dashTotal = (2 * r * Math.PI);
        var currentRotate = 9;
        // Cleanup
        removeAllChildren(this._chart);
        if (this._legend) {
            removeAllChildren(this._legend);
        }
        var percentageAdjustTotal = 0;
        var percentageAdjust = 0;
        var separatorPercentage = DASH_SEPARATOR_WIDTH / 100;
        for (var i = 0; i < this._data.length; i++) {
            var entry = this._data[i];
            var percentage = entry.value / total;
            if (percentage < separatorPercentage) {
                percentageAdjustTotal += (separatorPercentage - percentage);
                percentageAdjust++;
            }
        }
        if (percentageAdjust > 0) {
            percentageAdjust = percentageAdjustTotal / (this._data.length - percentageAdjust);
        }
        var animations = anime.timeline();
        var animationOffset = 0;
        var _loop_1 = function (i) {
            var entry = this_1._data[i];
            var displayPercentage = entry.value / total;
            var percentage = Math.max(separatorPercentage, displayPercentage - percentageAdjust);
            var dashWidth = (percentage * dashTotal) - DASH_SEPARATOR_WIDTH;
            var svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
            svg.setAttribute("viewBox", "0 0 34 34");
            svg.setAttribute("role", "img");
            svg.setAttribute("aria-labelledby", "title desc");
            var title = document.createElementNS("http://www.w3.org/2000/svg", "title");
            title.setAttribute("id", "title");
            title.innerHTML = "Pie chart segment " + Math.floor(displayPercentage * 100) + "%";
            var description = document.createElementNS("http://www.w3.org/2000/svg", "desc");
            description.setAttribute("id", "desc");
            description.innerHTML = entry.title + ": " + entry.value;
            var circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
            circle.setAttribute("cx", "17");
            circle.setAttribute("cy", "17");
            circle.setAttribute("r", String(r));
            if (isColor(entry.color) === true) {
                circle.setAttribute("stroke", "" + entry.color);
            }
            else {
                circle.setAttribute("class", entry.color);
            }
            circle.setAttribute("role", "presentation");
            svg.setAttribute("style", "transform: rotate(" + currentRotate + "deg);");
            svg.appendChild(title);
            svg.appendChild(description);
            svg.appendChild(circle);
            this_1._chart.appendChild(svg);
            var animationDuration = ANIMATION_DURATION * percentage;
            circle.style.display = "none";
            var counter = { var: 0.5 };
            animations.add({
                targets: counter,
                var: dashWidth,
                begin: function () {
                    circle.style.display = "";
                },
                update: function () {
                    circle.setAttribute("stroke-dasharray", counter.var + " " + dashTotal);
                },
                duration: animationDuration,
                easing: "easeInQuint"
            });
            // Legend
            if (this_1._legend && (this_1._data.length > 1) || this_1._alwaysShowLegend) {
                var bullet = new DomElement("span")
                    .addClass("bullet");
                if (isColor(entry.color) === true) {
                    bullet.setAttribute("style", "background-color: " + entry.color);
                }
                else {
                    bullet.addClass(entry.color);
                }
                var caption = new DomElement("span");
                var captionElement = caption.element;
                captionElement.innerText = entry.title;
                var legendItem = new DomElement("li")
                    .appendChild(bullet)
                    .appendChild(caption);
                this_1._legend.appendChild(legendItem.element);
                this_1._animateLegend(legendItem.element, animationOffset);
            }
            animationOffset += animationDuration;
            currentRotate += (360 * percentage);
            if (i === this_1._data.length - 1) {
                this_1._title.innerHTML = entry.value + " " + this_1._unit;
                this_1._subtitle.innerHTML = entry.title;
            }
        };
        var this_1 = this;
        for (var i = 0; i < this._data.length; i++) {
            _loop_1(i);
        }
    };
    PieChart.prototype._animateLegend = function (legendItem, animationOffset) {
        legendItem.style.opacity = "0";
        anime({
            targets: legendItem,
            duration: ANIMATION_DURATION_LEGEND,
            opacity: 1,
            easing: "easeInOutQuint",
            delay: animationOffset,
            complete: function () {
                legendItem.style.removeProperty("opacity");
            }
        });
    };
    /**
     * Updates the pie chart with the specified data definitions.
     * @param {Array} - pie chart data definitions.
     */
    PieChart.prototype.update = function (data) {
        if (data) {
            this._data = data;
        }
        this._render();
    };
    /**
     * Removes all event handlers and clears references.
     */
    PieChart.prototype.destroy = function () {
        this._data = undefined;
        this._title = undefined;
        this._subtitle = undefined;
        this._unit = undefined;
        removeAllChildren(this._chart);
        this._chart = undefined;
        if (this._legend) {
            removeAllChildren(this._legend);
            this._legend = undefined;
        }
    };
    /**
     * @deprecated use destroy() instead.
     * @todo remove in version 2.0.0
     */
    PieChart.prototype.destory = function () {
        this.destroy();
    };
    return PieChart;
}(DomElement));
export function init() {
    searchAndInitialize(".pie-chart", function (e) {
        new PieChart(e);
    });
}
export default PieChart;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4vc3JjL2NoYXJ0cy9QaWVDaGFydC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxVQUFVLE1BQU0sZUFBZSxDQUFBO0FBQ3RDLE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLFVBQVUsQ0FBQTtBQUM5QyxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsVUFBVSxFQUFFLE9BQU8sRUFBYSxNQUFNLGtCQUFrQixDQUFBO0FBQ3BGLE9BQU8sS0FBSyxNQUFNLFNBQVMsQ0FBQTtBQUUzQixJQUFNLFdBQVcsR0FBRyxXQUFXLENBQUE7QUFDL0IsSUFBTSxZQUFZLEdBQUcsWUFBWSxDQUFBO0FBRWpDLElBQU0sb0JBQW9CLEdBQUcsQ0FBQyxDQUFBO0FBQzlCLElBQU0sa0JBQWtCLEdBQUcsSUFBSSxDQUFBO0FBQy9CLElBQU0seUJBQXlCLEdBQUcsR0FBRyxDQUFBO0FBRXJDLElBQU0sZ0JBQWdCLEdBQUcsY0FBYyxDQUFBO0FBQ3ZDLElBQU0sbUJBQW1CLEdBQUcsaUJBQWlCLENBQUE7QUFFN0M7O0dBRUc7QUFDSDtJQUF1Qiw0QkFBdUI7SUFXNUM7Ozs7T0FJRztJQUNILGtCQUFZLE9BQW9CLEVBQUUsSUFBZ0I7UUFBbEQsWUFDRSxrQkFBTSxPQUFPLENBQUMsU0FNZjtRQUxDLElBQUksSUFBSSxFQUFFO1lBQ1IsS0FBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUE7U0FDbEI7UUFFRCxLQUFJLENBQUMsV0FBVyxFQUFFLENBQUE7O0lBQ3BCLENBQUM7SUFFUyw4QkFBVyxHQUFyQjtRQUNFLElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxhQUFhLENBQUMsV0FBVyxDQUFpQixDQUFBO1FBQ3JFLElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxhQUFhLENBQUMsWUFBWSxDQUFpQixDQUFBO1FBQ3ZFLElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxhQUFhLENBQUMs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RUQ7OztPQUdHO0lBQ0ksMEJBQU8sR0FBZDtRQUNFLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQTtJQUNoQixDQUFDO0lBQ0gsZUFBQztBQUFELENBMU5BLEFBME5DLENBMU5zQixVQUFVLEdBME5oQztBQUVELE1BQU0sVUFBVSxJQUFJO0lBQ2xCLG1CQUFtQixDQUFjLFlBQVksRUFBRSxVQUFDLENBQUM7UUFDL0MsSUFBSSxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUE7SUFDakIsQ0FBQyxDQUFDLENBQUE7QUFDSixDQUFDO0FBRUQsZUFBZSxRQUFRLENBQUEiLCJmaWxlIjoibWFpbi9zcmMvY2hhcnRzL1BpZUNoYXJ0LmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IERvbUVsZW1lbnQgZnJvbSBcIi4uL0RvbUVsZW1lbnRcIlxuaW1wb3J0IHsgc2VhcmNoQW5kSW5pdGlhbGl6ZSB9IGZyb20gXCIuLi9VdGlsc1wiXG5pbXBvcnQgeyByZW1vdmVBbGxDaGlsZHJlbiwgdHJ5R2V0RGF0YSwgaXNDb2xvciwgQ2hhcnREYXRhIH0gZnJvbSBcIi4vQ2hhcnRGdW5jdGlvbnNcIlxuaW1wb3J0IGFuaW1lIGZyb20gXCJhbmltZWpzXCJcblxuY29uc3QgUVVFUllfQ0hBUlQgPSBcIi5qcy1jaGFydFwiXG5jb25zdCBRVUVSWV9MRUdFTkQgPSBcIi5qcy1sZWdlbmRcIlxuXG5jb25zdCBEQVNIX1NFUEFSQVRPUl9XSURUSCA9IDNcbmNvbnN0IEFOSU1BVElPTl9EVVJBVElPTiA9IDE1MDBcbmNvbnN0IEFOSU1BVElPTl9EVVJBVElPTl9MRUdFTkQgPSA1MDBcblxuY29uc3QgUVVFUllfTUVUQV9USVRMRSA9IFwiLm1ldGEgLnRpdGxlXCJcbmNvbnN0IFFVRVJZX01FVEFfU1VCVElUTEUgPSBcIi5tZXRhIC5zdWJ0aXRsZVwiXG5cbi8qKlxuICogUGllIENoYXJ0IENvbXBvbmVudC5cbiAqL1xuY2xhc3MgUGllQ2hhcnQgZXh0ZW5kcyBEb21FbGVtZW50PEhUTUxFbGVtZW50PiB7XG4gIHByaXZhdGUgX2RhdGEhOiBDaGFydERhdGFcblxuICBwcml2YXRlIF9jaGFydCE6IEhUTUxFbGVtZW50XG4gIHByaXZhdGUgX2xlZ2VuZCE6IEhUTUxFbGVtZW50XG4gIHByaXZhdGUgX3RpdGxlITogSFRNTEVsZW1lbnRcbiAgcHJpdmF0ZSBfc3VidGl0bGUhOiBIVE1MRWxlbWVudFxuXG4gIHByaXZhdGUgX3VuaXQhOiBzdHJpbmdcbiAgcHJpdmF0ZSBfYWx3YXlzU2hvd0xlZ2VuZCE6IGJvb2xlYW5cblxuICAvKipcbiAgICogQ3JlYXRlcyBhbmQgaW5pdGlhbGl6ZXMgdGhlIFBpZSBDaGFydCBjb21wb25lbnQuXG4gICAqIEBwYXJhbSB7RG9tRWxlbWVudH0gLSByb290IGVsZW1lbnQgb2YgdGhlIGNoYXJ0LlxuICAgKiBAcGFyYW0ge0FycmF5fSAtIHBpZSBjaGFydCBkYXRhIGRlZmluaXRpb25zLlxuICAgKi9cbiAgY29uc3RydWN0b3IoZWxlbWVudDogSFRNTEVsZW1lbnQsIGRhdGE/OiBDaGFydERhdGEpIHtcbiAgICBzdXBlcihlbGVtZW50KVxuICAgIGlmIChkYXRhKSB7XG4gICAgICB0aGlzLl9kYXRhID0gZGF0YVxuICAgIH1cblxuICAgIHRoaXMuX2luaXRpYWxpemUoKVxuICB9XG5cbiAgcHJvdGVjdGVkIF9pbml0aWFsaXplKCkge1xuICAgIHRoaXMuX2NoYXJ0ID0gdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoUVVFUllfQ0hBUlQpISBhcyBIVE1MRWxlbWVudFxuICAgIHRoaXMuX2xlZ2VuZCA9IHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKFFVRVJZX0xFR0VORCkhIGFzIEhUTUxFbGVtZW50XG4gICAgdGhpcy5fdGl0bGUgPSB0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3RvcihRVUVSWV9NRVRBX1RJVExFKSEgYXMgSFRNTEVsZW1lbnRcbiAgICB0aGlzLl9zdWJ0aXRsZSA9IHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKFFVRVJZX01FVEFfU1VCVElUTEUpISBhcyBIVE1MRWxlbWVudFxuXG4gICAgdGhpcy5fdW5pdCA9IHRoaXMuZ2V0QXR0cmlidXRlKFwiZGF0YS11bml0XCIpIHx8IFwiXCJcbiAgICB0aGlzLl9hbHdheXNTaG93TGVnZW5kID0gdGhpcy5lbGVtZW50Lmhhc0F0dHJpYnV0ZShcImRhdGEtYWx3YXlzLXNob3ctbGVnZW5kXCIpXG5cbiAgICBpZiAoIXRoaXMuX2RhdGEpIHtcbiAgICAgIHRoaXMuX2RhdGEgPSB0cnlHZXREYXRhKHRoaXMuZWxlbWVudClcbiAgICB9XG5cbiAgICB0aGlzLl9yZW5kZXIoKVxuICB9XG5cbiAgcHJvdGVjdGVkIF9yZW5kZXIoKSB7XG4gICAgY29uc3QgdG90YWwgPSB0aGlzLl9kYXRhLnJlZHVjZSgoYSwgYikgPT4gYSArIGIudmFsdWUsIDApXG4gICAgY29uc3QgciA9IDE2XG4gICAgY29uc3QgZGFzaFRvdGFsID0gKDIgKiByICogTWF0aC5QSSlcblxuICAgIGxldCBjdXJyZW50Um90YXRlID0gOVxuXG4gICAgLy8gQ2xlYW51cFxuICAgIHJlbW92ZUFsbENoaWxkcmVuKHRoaXMuX2NoYXJ0KVxuXG4gICAgaWYgKHRoaXMuX2xlZ2VuZCkge1xuICAgICAgcmVtb3ZlQWxsQ2hpbGRyZW4odGhpcy5fbGVnZW5kKVxuICAgIH1cblxuICAgIGxldCBwZXJjZW50YWdlQWRqdXN0VG90YWwgPSAwXG4gICAgbGV0IHBlcmNlbnRhZ2VBZGp1c3QgPSAwXG4gICAgY29uc3Qgc2VwYXJhdG9yUGVyY2VudGFnZSA9IERBU0hfU0VQQVJBVE9SX1dJRFRIIC8gMTAwXG5cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuX2RhdGEubGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IGVudHJ5ID0gdGhpcy5fZGF0YVtpXVxuXG4gICAgICBjb25zdCBwZXJjZW50YWdlID0gZW50cnkudmFsdWUgLyB0b3RhbFxuICAgICAgaWYgKHBlcmNlbnRhZ2UgPCBzZXBhcmF0b3JQZXJjZW50YWdlKSB7XG4gICAgICAgIHBlcmNlbnRhZ2VBZGp1c3RUb3RhbCArPSAoc2VwYXJhdG9yUGVyY2VudGFnZSAtIHBlcmNlbnRhZ2UpXG4gICAgICAgIHBlcmNlbnRhZ2VBZGp1c3QrK1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChwZXJjZW50YWdlQWRqdXN0ID4gMCkge1xuICAgICAgcGVyY2VudGFnZUFkanVzdCA9IHBlcmNlbnRhZ2VBZGp1c3RUb3RhbCAvICh0aGlzLl9kYXRhLmxlbmd0aCAtIHBlcmNlbnRhZ2VBZGp1c3QpXG4gICAgfVxuXG4gICAgY29uc3QgYW5pbWF0aW9ucyA9IGFuaW1lLnRpbWVsaW5lKClcblxuICAgIGxldCBhbmltYXRpb25PZmZzZXQgPSAwXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLl9kYXRhLmxlbmd0aDsgaSsrKSB7XG4gICAgICBjb25zdCBlbnRyeSA9IHRoaXMuX2RhdGFbaV1cblxuICAgICAgY29uc3QgZGlzcGxheVBlcmNlbnRhZ2UgPSBlbnRyeS52YWx1ZSAvIHRvdGFsXG4gICAgICBjb25zdCBwZXJjZW50YWdlID0gTWF0aC5tYXgoc2VwYXJhdG9yUGVyY2VudGFnZSwgZGlzcGxheVBlcmNlbnRhZ2UgLSBwZXJjZW50YWdlQWRqdXN0KVxuXG4gICAgICBsZXQgZGFzaFdpZHRoID0gKHBlcmNlbnRhZ2UgKiBkYXNoVG90YWwpIC0gREFTSF9TRVBBUkFUT1JfV0lEVEhcblxuICAgICAgbGV0IHN2ZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhcImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCIsIFwic3ZnXCIpXG4gICAgICBzdmcuc2V0QXR0cmlidXRlKFwidmlld0JveFwiLCBcIjAgMCAzNCAzNFwiKVxuICAgICAgc3ZnLnNldEF0dHJpYnV0ZShcInJvbGVcIiwgXCJpbWdcIilcbiAgICAgIHN2Zy5zZXRBdHRyaWJ1dGUoXCJhcmlhLWxhYmVsbGVkYnlcIiwgXCJ0aXRsZSBkZXNjXCIpXG5cbiAgICAgIGxldCB0aXRsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhcImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCIsIFwidGl0bGVcIilcbiAgICAgIHRpdGxlLnNldEF0dHJpYnV0ZShcImlkXCIsIFwidGl0bGVcIilcbiAgICAgIHRpdGxlLmlubmVySFRNTCA9IGBQaWUgY2hhcnQgc2VnbWVudCAke01hdGguZmxvb3IoZGlzcGxheVBlcmNlbnRhZ2UgKiAxMDApfSVgXG5cbiAgICAgIGxldCBkZXNjcmlwdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhcImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCIsIFwiZGVzY1wiKVxuICAgICAgZGVzY3JpcHRpb24uc2V0QXR0cmlidXRlKFwiaWRcIiwgXCJkZXNjXCIpXG4gICAgICBkZXNjcmlwdGlvbi5pbm5lckhUTUwgPSBgJHtlbnRyeS50aXRsZX06ICR7ZW50cnkudmFsdWV9YFxuXG4gICAgICBsZXQgY2lyY2xlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKFwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcIiwgXCJjaXJjbGVcIilcbiAgICAgIGNpcmNsZS5zZXRBdHRyaWJ1dGUoXCJjeFwiLCBcIjE3XCIpXG4gICAgICBjaXJjbGUuc2V0QXR0cmlidXRlKFwiY3lcIiwgXCIxN1wiKVxuICAgICAgY2lyY2xlLnNldEF0dHJpYnV0ZShcInJcIiwgU3RyaW5nKHIpKVxuXG4gICAgICBpZiAoaXNDb2xvcihlbnRyeS5jb2xvcikgPT09IHRydWUpIHtcbiAgICAgICAgY2lyY2xlLnNldEF0dHJpYnV0ZShcInN0cm9rZVwiLCBgJHtlbnRyeS5jb2xvcn1gKVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY2lyY2xlLnNldEF0dHJpYnV0ZShcImNsYXNzXCIsIGVudHJ5LmNvbG9yKVxuICAgICAgfVxuXG4gICAgICBjaXJjbGUuc2V0QXR0cmlidXRlKFwicm9sZVwiLCBcInByZXNlbnRhdGlvblwiKVxuICAgICAgc3ZnLnNldEF0dHJpYnV0ZShcInN0eWxlXCIsIGB0cmFuc2Zvcm06IHJvdGF0ZSgke2N1cnJlbnRSb3RhdGV9ZGVnKTtgKVxuXG4gICAgICBzdmcuYXBwZW5kQ2hpbGQodGl0bGUpXG4gICAgICBzdmcuYXBwZW5kQ2hpbGQoZGVzY3JpcHRpb24pXG4gICAgICBzdmcuYXBwZW5kQ2hpbGQoY2lyY2xlKVxuICAgICAgdGhpcy5fY2hhcnQuYXBwZW5kQ2hpbGQoc3ZnKVxuXG4gICAgICBsZXQgYW5pbWF0aW9uRHVyYXRpb24gPSBBTklNQVRJT05fRFVSQVRJT04gKiBwZXJjZW50YWdlXG4gICAgICBjaXJjbGUuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiXG5cbiAgICAgIGxldCBjb3VudGVyID0geyB2YXI6IDAuNSB9XG4gICAgICBhbmltYXRpb25zLmFkZCh7XG4gICAgICAgIHRhcmdldHM6IGNvdW50ZXIsXG4gICAgICAgIHZhcjogZGFzaFdpZHRoLFxuICAgICAgICBiZWdpbjogKCkgPT4ge1xuICAgICAgICAgIGNpcmNsZS5zdHlsZS5kaXNwbGF5ID0gXCJcIlxuICAgICAgICB9LFxuICAgICAgICB1cGRhdGU6ICgpID0+IHtcbiAgICAgICAgICBjaXJjbGUuc2V0QXR0cmlidXRlKFwic3Ryb2tlLWRhc2hhcnJheVwiLCBgJHtjb3VudGVyLnZhcn0gJHtkYXNoVG90YWx9YClcbiAgICAgICAgfSxcbiAgICAgICAgZHVyYXRpb246IGFuaW1hdGlvbkR1cmF0aW9uLFxuICAgICAgICBlYXNpbmc6IFwiZWFzZUluUXVpbnRcIlxuICAgICAgfSlcblxuICAgICAgLy8gTGVnZW5kXG4gICAgICBpZiAodGhpcy5fbGVnZW5kICYmICh0aGlzLl9kYXRhLmxlbmd0aCA+IDEpIHx8IHRoaXMuX2Fsd2F5c1Nob3dMZWdlbmQpIHtcbiAgICAgICAgbGV0IGJ1bGxldCA9IG5ldyBEb21FbGVtZW50KFwic3BhblwiKVxuICAgICAgICAgIC5hZGRDbGFzcyhcImJ1bGxldFwiKVxuXG4gICAgICAgIGlmIChpc0NvbG9yKGVudHJ5LmNvbG9yKSA9PT0gdHJ1ZSkge1xuICAgICAgICAgIGJ1bGxldC5zZXRBdHRyaWJ1dGUoXCJzdHlsZVwiLCBgYmFja2dyb3VuZC1jb2xvcjogJHtlbnRyeS5jb2xvcn1gKVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGJ1bGxldC5hZGRDbGFzcyhlbnRyeS5jb2xvcilcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGNhcHRpb24gPSBuZXcgRG9tRWxlbWVudChcInNwYW5cIilcbiAgICAgICAgY29uc3QgY2FwdGlvbkVsZW1lbnQgPSBjYXB0aW9uLmVsZW1lbnQgYXMgSFRNTEVsZW1lbnRcbiAgICAgICAgY2FwdGlvbkVsZW1lbnQuaW5uZXJUZXh0ID0gZW50cnkudGl0bGVcblxuICAgICAgICBsZXQgbGVnZW5kSXRlbSA9IG5ldyBEb21FbGVtZW50KFwibGlcIilcbiAgICAgICAgICAuYXBwZW5kQ2hpbGQoYnVsbGV0KVxuICAgICAgICAgIC5hcHBlbmRDaGlsZChjYXB0aW9uKVxuXG4gICAgICAgIHRoaXMuX2xlZ2VuZC5hcHBlbmRDaGlsZChsZWdlbmRJdGVtLmVsZW1lbnQpXG5cbiAgICAgICAgdGhpcy5fYW5pbWF0ZUxlZ2VuZChsZWdlbmRJdGVtLmVsZW1lbnQgYXMgSFRNTEVsZW1lbnQsIGFuaW1hdGlvbk9mZnNldClcbiAgICAgIH1cbiAgICAgIGFuaW1hdGlvbk9mZnNldCArPSBhbmltYXRpb25EdXJhdGlvblxuXG4gICAgICBjdXJyZW50Um90YXRlICs9ICgzNjAgKiBwZXJjZW50YWdlKVxuXG4gICAgICBpZiAoaSA9PT0gdGhpcy5fZGF0YS5sZW5ndGggLSAxKSB7XG4gICAgICAgIHRoaXMuX3RpdGxlLmlubmVySFRNTCA9IGAke2VudHJ5LnZhbHVlfSAke3RoaXMuX3VuaXR9YFxuICAgICAgICB0aGlzLl9zdWJ0aXRsZS5pbm5lckhUTUwgPSBlbnRyeS50aXRsZVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgX2FuaW1hdGVMZWdlbmQobGVnZW5kSXRlbTogSFRNTEVsZW1lbnQsIGFuaW1hdGlvbk9mZnNldDogbnVtYmVyKSB7XG4gICAgbGVnZW5kSXRlbS5zdHlsZS5vcGFjaXR5ID0gXCIwXCJcbiAgICBhbmltZSh7XG4gICAgICB0YXJnZXRzOiBsZWdlbmRJdGVtLFxuICAgICAgZHVyYXRpb246IEFOSU1BVElPTl9EVVJBVElPTl9MRUdFTkQsXG4gICAgICBvcGFjaXR5OiAxLFxuICAgICAgZWFzaW5nOiBcImVhc2VJbk91dFF1aW50XCIsXG4gICAgICBkZWxheTogYW5pbWF0aW9uT2Zmc2V0LFxuICAgICAgY29tcGxldGU6ICgpID0+IHtcbiAgICAgICAgbGVnZW5kSXRlbS5zdHlsZS5yZW1vdmVQcm9wZXJ0eShcIm9wYWNpdHlcIilcbiAgICAgIH1cbiAgICB9KVxuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZXMgdGhlIHBpZSBjaGFydCB3aXRoIHRoZSBzcGVjaWZpZWQgZGF0YSBkZWZpbml0aW9ucy5cbiAgICogQHBhcmFtIHtBcnJheX0gLSBwaWUgY2hhcnQgZGF0YSBkZWZpbml0aW9ucy5cbiAgICovXG4gIHB1YmxpYyB1cGRhdGUoZGF0YTogQ2hhcnREYXRhKSB7XG4gICAgaWYgKGRhdGEpIHtcbiAgICAgIHRoaXMuX2RhdGEgPSBkYXRhXG4gICAgfVxuXG4gICAgdGhpcy5fcmVuZGVyKClcbiAgfVxuXG4gIC8qKlxuICAgKiBSZW1vdmVzIGFsbCBldmVudCBoYW5kbGVycyBhbmQgY2xlYXJzIHJlZmVyZW5jZXMuXG4gICAqL1xuICBwdWJsaWMgZGVzdHJveSgpIHtcbiAgICAodGhpcyBhcyBhbnkpLl9kYXRhID0gdW5kZWZpbmVkO1xuICAgICh0aGlzIGFzIGFueSkuX3RpdGxlID0gdW5kZWZpbmVkO1xuICAgICh0aGlzIGFzIGFueSkuX3N1YnRpdGxlID0gdW5kZWZpbmVkO1xuICAgICh0aGlzIGFzIGFueSkuX3VuaXQgPSB1bmRlZmluZWRcblxuICAgIHJlbW92ZUFsbENoaWxkcmVuKHRoaXMuX2NoYXJ0KTtcbiAgICAodGhpcyBhcyBhbnkpLl9jaGFydCA9IHVuZGVmaW5lZFxuXG4gICAgaWYgKHRoaXMuX2xlZ2VuZCkge1xuICAgICAgcmVtb3ZlQWxsQ2hpbGRyZW4odGhpcy5fbGVnZW5kKTtcbiAgICAgICh0aGlzIGFzIGFueSkuX2xlZ2VuZCA9IHVuZGVmaW5lZFxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBAZGVwcmVjYXRlZCB1c2UgZGVzdHJveSgpIGluc3RlYWQuXG4gICAqIEB0b2RvIHJlbW92ZSBpbiB2ZXJzaW9uIDIuMC4wXG4gICAqL1xuICBwdWJsaWMgZGVzdG9yeSgpIHtcbiAgICB0aGlzLmRlc3Ryb3koKVxuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpbml0KCkge1xuICBzZWFyY2hBbmRJbml0aWFsaXplPEhUTUxFbGVtZW50PihcIi5waWUtY2hhcnRcIiwgKGUpID0+IHtcbiAgICBuZXcgUGllQ2hhcnQoZSlcbiAgfSlcbn1cblxuZXhwb3J0IGRlZmF1bHQgUGllQ2hhcnRcbiJdLCJzb3VyY2VSb290IjoiLi4vLi4vLi4vLi4vLi4ifQ==
